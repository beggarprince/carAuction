<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Enter car type shit</title>
</head>
<body>
<h1>Please enter your car details</h1>
<form id ="carForm" action="register" method="post">

    <label for="mileage">Mileage</label>
    <input type="number" id="mileage" name="mileage"><br>

    <label for="make">Make</label>
    <select id="make" name="make" required>
        <option value="" disabled selected>Select a Car Make</option>
        <option value="Chevrolet">Chevrolet</option>
        <option value="Ford">Ford</option>
        <option value="Honda">Honda</option>
        <option value="Nissan">Nissan</option>
        <option value="Toyota">Toyota</option>
        <optgroup label="Other Makes">
            <option value="Acura">Acura</option>
            <option value="Audi">Audi</option>
            <option value="BMW">BMW</option>
            <option value="Buick">Buick</option>
            <option value="Cadillac">Cadillac</option>
            <option value="Chrysler">Chrysler</option>
            <option value="Dodge">Dodge</option>
            <option value="Genesis">Genesis</option>
            <option value="GMC">GMC</option>
            <option value="Hyundai">Hyundai</option>
            <option value="Infiniti">Infiniti</option>
            <option value="Jaguar">Jaguar</option>
            <option value="Jeep">Jeep</option>
            <option value="Kia">Kia</option>
            <option value="Land Rover">Land Rover</option>
            <option value="Lexus">Lexus</option>
            <option value="Lincoln">Lincoln</option>
            <option value="Mazda">Mazda</option>
            <option value="Mercedes-Benz">Mercedes-Benz</option>
            <option value="Mini">Mini</option>
            <option value="Mitsubishi">Mitsubishi</option>
            <option value="Porsche">Porsche</option>
            <option value="Ram">Ram</option>
            <option value="Subaru">Subaru</option>
            <option value="Volkswagen">Volkswagen</option>
            <option value="Volvo">Volvo</option>
            <option value="Other">Other</option>
        </optgroup>
    </select>

    <!--I should probably do another select based off of car makes-->
    <label for="model">Model</label>
    <input type="text" id="model" name="model"><br>

    <label for="price">Price</label>
    <input type="number" id="price" name="price"><br>

    <label for="year">Year</label>
    <input type="number" id="year" name="year"><br>

    <button type="submit">Register</button>
</form>

<div id="response">
    Enter car information
</div> <br>
<div id ="welcome">
    Welcome
</div>

<script>
    const response = document.getElementById('response');
    const form = document.getElementById('carForm');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const body = {
            make: document.getElementById("make").value,
            model: document.getElementById("model").value,
            year: document.getElementById("year").value,
            price: document.getElementById("price").value,
            <!--The user needs to be passed, it's not an element in the html -->
            id: localStorage.getItem("id")
        }

        try{
            const res = await
                fetch('/uploadCar',{
                method: 'POST',
                headers: { 'Content-Type': 'application/json'},
                body: JSON.stringify(body)
            });

            if(res.ok){
                const data = await res.json();
                response.textContent = `Successfully uploaded car (id ${data.id})`;
                response.style.color = 'green';
            }
            else{
                const text = await res.text();
                response.textContent = text;
                response.style.color = 'red';
            }


        }catch(err){
            response.textContent = 'Error submitting car' + err.message;
            response.style.color = 'red';
        }
    })

</script>

<script>
    ( async  () => {

        try{

            const id = localStorage.getItem("id")
            document.getElementById("welcome").textContent =
                `Welcome to the Circus of Value, ${id}`;
        } catch(err){
            console.error(err);
        }
    })();
</script>

</body>
</html>