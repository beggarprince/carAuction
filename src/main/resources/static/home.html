<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <title>Home Page</title>
</head>
<body>
<h1>Home Page</h1>
<div class="headerBar">

    <button>button</button>

    <button>button2</button>
<div style="width: 200px">
    <img src="/images/noImg.png">
</div>
    <a id="tempReg" href="/register.html">
        Register button
    </a>
    <a id="tempLogin" href="/login.html">
        Login
    </a>
    <a id="tempRegCar" href="/uploadCar.html">
        Upload Car Listing
    </a>

</div>

<div id="text"></div>
<img id="image" alt="Dynamic Image" margin="25px"/><br>

<div id="tempMessage">This is also temporarily working as the dashboard type ls</div>

<script>
    fetch('/home-data')
        .then(response => response.json())
        .then(data => {
            // Show the strings
            const textDiv = document.getElementById('text');
            textDiv.innerText = data.strings.join(' ');

            // Set the image
            const image = document.getElementById('image');
            image.src = data.imgUrl;
        });
</script>

<div id="welcome">WELCOME TO THE CIRCUS OF VALUE</div>

<button id="fetchCars">
    Fetch Cars
</button>

<script>
    ( async  () => {
        const token = localStorage.getItem("jwt")

        if(!token) return;

        try{
            let token = localStorage.getItem("jwt") ?? "";
            token = token.replace("Bearer", "");
            //console.log("My jwt token is " + token)
            const res = await fetch("/api/users/me",
                {
                    headers: {Authorization: `Bearer ${token}`}
                });

            if(!res.ok) throw new Error(("Unauthorized"))

            console.log(res);

            const resJson = await res.json();
            console.log(resJson);

            const {name} = resJson;
            const {username} = resJson;
            const {id} = resJson;

            localStorage.setItem("name", name);
            localStorage.setItem("username", username);
            localStorage.setItem("id", id);

            document.getElementById("welcome").textContent =
                `Welcome to the Circus of Value, ${name}, username being ${username}\nId:${id}`;
        } catch(err){
            console.error(err);
        }
    })();
</script>

<script>
    const btnFetch = document.getElementById('fetchCars');
    btnFetch.addEventListener('click', async (e) => {

        try {
            const fetchCarResponse = await fetch('/cars/getList?filter=top5desc',
                {method:'POST'});

            console.log(fetchCarResponse.json());

        }catch(e){
            console.log("Could not fetch cars type")
        }

    })
</script>


<p> Copyright type shit</p>
</body>
</html>
